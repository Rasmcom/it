<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>تقرير تفعيل التعلم الإلكتروني</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* خط كايرو */
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');

    /* ألوان وأبعاد قابلة للتعديل */
    :root{
      --navy:#0c2f4b;      /* كحلي غامق */
      --green:#16a34a;     /* أخضر */
      --blue:#0ea5e9;      /* أزرق */
      --top-strip-h:3mm;   /* الشريط العلوي الصغير */
      --header-h:35mm;     /* إجمالي ارتفاع الهيدر */
      --footer-h:6mm;      /* ارتفاع الفوتر */
      --sig-h:22mm;        /* ارتفاع منطقة التواقيع */
    }

    /* أساسيات العرض */
    html,body{ height:auto; }
    body{
      font-family:'Cairo',system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;
      background:#f0f0f0; margin:0; padding:10px;
      display:flex; justify-content:center; align-items:flex-start; color:#000;
    }
    .a4-page{
      width:210mm; min-height:297mm; background:#fff; position:relative; margin:0 auto;
      box-shadow:0 0 10px rgba(0,0,0,.3);
      padding: 0; /* سنضبط المسافات أدناه */
      overflow:hidden; /* يمنع أي امتداد بصري خارج الصفحة */
    }

    /* الهيدر والفوتر بالألوان (للـ شاشة) عبر ::before/::after */
    .a4-page::before{
      content:"";
      position:absolute; inset:auto 0 auto 0; top:0; height:var(--header-h);
      background:
        linear-gradient(90deg, var(--green) 0 50%, var(--blue) 50% 100%) top/100% var(--top-strip-h) no-repeat,
        var(--navy);
      z-index:0;
    }
    .a4-page::after{
      content:"";
      position:absolute; left:0; right:0; bottom:0; height:var(--footer-h);
      background:linear-gradient(90deg, var(--green) 0 50%, var(--blue) 50% 100%);
      z-index:0;
    }

    /* حقول الهيدر (الإدارة/المدرسة/العنوان) موضوعة فوق الخلفية */
    .header-fields{
      position:absolute; top:0; left:0; right:0; height:var(--header-h);
      display:flex; flex-direction:column; align-items:flex-end; justify-content:flex-start;
      padding: 5mm 15mm;
      z-index:2;
    }
    .header-input{
      background:transparent; border:none; outline:none; width:100%;
      text-align:right; color:#fff; font-weight:900; font-size:14px; padding:2px 4px;
    }
    .header-title{
      color:#fff; font-weight:900; font-size:16px; text-align:center; line-height:1.2;
      text-shadow:1px 1px 2px rgba(0,0,0,.5); margin-top:2mm; width:100%;
    }

    /* منطقة المحتوى والتواقيع */
    .content-wrapper{
      position:relative; z-index:1;
      margin: calc(var(--header-h) + 2mm) 4mm 0 4mm;  /* أسفل الهيدر + هوامش جانبية صغيرة */
      padding:0;
      /* سيتم حد الارتفاع في الطباعة */
    }
    .signature-footer{
      position:absolute; left:4mm; right:4mm; bottom: calc(var(--footer-h) + 2mm);
      height: var(--sig-h);
      margin:0; padding:0; z-index:1;
      display:flex; justify-content:space-between;
    }

    /* الحقول الأساسية */
    .main-data-input{
      background:rgba(245,245,245,.9);
      border:1px solid #ccc;
      color:#000; text-align:center;
      font-weight:900; font-size:14px;
      padding:4px 8px; border-radius:6px;
    }
    /* العناوين الثابتة فوق الحقول */
    label{ font-weight:900 !important; font-size:13px !important; color:#000 !important; }

    /* الجداول */
    .h2-title{
      background:#e0f7fa; padding:2px 8px; border-radius:4px; color:#000;
      display:inline-block; margin:.15rem 0 .05rem; font-size:14px; font-weight:700;
      border-right:4px solid #00bcd4;
    }
    .report-table{ width:100%; border-collapse:collapse; margin-top:.05rem; color:#000; font-size:10px; }
    .report-table th,.report-table td{ border:1px solid #666; padding:2px; text-align:center; background:rgba(255,255,255,.9); }
    .report-table th{ background:#b2ebdd; font-size:11px; }
    .fillable-input{ background:rgba(255,255,255,.8); border:1px dashed #666; color:#000; padding:0 4px; width:100%; font-size:11px; font-weight:bold; outline:none; }
    .platform-input{ border:1px solid #666 !important; border-radius:0 !important; }

    /* الصور (الشواهد) */
    .evidence-box{ background:transparent; border:none; padding:2px; text-align:right; min-height:110px; }
    .image-slot-container{ width:24.2%; position:relative; }
    .image-slot-aspect{ width:100%; padding-top:70%; position:relative; cursor:pointer; border:1px dashed #666; background:rgba(240,240,240,.5); border-radius:6px; overflow:hidden; }
    .image-slot-content{ position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; font-size:8px; }
    .image-slot-content img{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; display:none; }

    /* زر طباعة */
    .print-button{ position:fixed; top:1rem; left:1rem; z-index:50; }

    /* ====== الطباعة: ورقة واحدة A4 ====== */
    @page{ size:A4 portrait; margin:0; }
    @media print{
      :root{ --print-scale: 0.98; } /* غيّرها 0.94–1.00 إذا احتجت */

      html,body{ margin:0 !important; padding:0 !important; background:#fff !important; }
      .print-button{ display:none !important; }

      .a4-page{
        width:210mm !important; height:297mm !important; min-height:297mm !important;
        margin:0 !important; box-shadow:none !important; overflow:hidden !important;
        -webkit-print-color-adjust:exact !important; print-color-adjust:exact !important;
        transform: scale(var(--print-scale)); transform-origin: top center;
      }
      /* خلفيات الهيدر/الفوتر ثابتة أثناء الطباعة */
      .a4-page::before{
        position:fixed; top:0; left:0; right:0; height:var(--header-h);
      }
      .a4-page::after{
        position:fixed; bottom:0; left:0; right:0; height:var(--footer-h);
      }

      /* حد أقصى لارتفاع المحتوى داخل الصفحة */
      .content-wrapper{
        margin: calc(var(--header-h) + 2mm) 4mm 0 4mm !important;
        max-height: calc(297mm - var(--header-h) - var(--footer-h) - var(--sig-h) - 6mm) !important;
        overflow:hidden !important; padding:0 !important;
      }

      /* تثبيت التواقيع أعلى الفوتر */
      .signature-footer{
        position:absolute; left:4mm; right:4mm; bottom: calc(var(--footer-h) + 2mm);
        height: var(--sig-h); margin:0 !important; padding:0 !important;
      }

      /* تقليل الحشو لربح ارتفاع */
      .report-table th, .report-table td{ padding:1px !important; }

      /* إخفاء حقول اختيار الصور وإظهارها كصور ثابتة */
      .image-slot-content input[type="file"]{ display:none !important; }
      .image-slot-content img{ display:block !important; }

      /* وضوح النصوص */
      .header-input{ color:#fff !important; font-weight:900 !important; font-size:14px !important; }
      label{ font-weight:900 !important; color:#000 !important; }
      .main-data-input{
        border:1px solid #999 !important; background:#f5f5f5 !important; border-radius:4px !important;
        font-weight:900 !important; color:#000 !important; /* الحجم يبقى 14px من الوضع العادي */
      }

      /* دعم iOS/Android */
      @supports (-webkit-touch-callout:none){
        .a4-page{ transform: scale(var(--print-scale)); transform-origin: top center; }
      }
    }
  </style>
</head>
<body>
  <!-- زر طباعة سريع -->
  <div class="print-button">
    <button onclick="window.print()" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow-lg transition duration-150">
      طباعة الصفحة (A4)
    </button>
  </div>

  <div class="a4-page">
    <!-- حقول الهيدر فوق الخلفية الملونة -->
    <div class="header-fields">
      <input type="text" id="adminName" data-key="adminName" class="header-input w-2/3 mb-1 text-right" placeholder="اسم الإدارة التعليمية" />
      <input type="text" id="schoolName" data-key="schoolName" class="header-input w-2/3 text-right" placeholder="اسم المدرسة" />
      <p class="header-title text-center">تفعيل المدرسة للتعلم الإلكتروني</p>
    </div>

    <!-- المحتوى -->
    <div class="content-wrapper">
      <!-- البلوك الأساسي -->
      <div class="grid grid-cols-4 gap-2 p-1 bg-gray-50 border border-gray-200 rounded-lg text-xs">
        <div>
          <label class="block text-xs text-gray-700 mb-1">الفصل الدراسي</label>
          <input type="text" data-key="t1_col1" class="main-data-input w-full text-center" placeholder="مثال: الأول / الثاني">
        </div>
        <div>
          <label class="block text-xs text-gray-700 mb-1">اليوم</label>
          <input type="text" data-key="t1_col2" class="main-data-input w-full text-center" placeholder="مثال: الأحد">
        </div>
        <div>
          <label class="block text-xs text-gray-700 mb-1">التاريخ</label>
          <input type="text" data-key="t1_col3" class="main-data-input w-full text-center" placeholder="مثال: 2025-01-01">
        </div>
        <div>
          <label class="block text-xs text-gray-700 mb-1">المكان</label>
          <input type="text" data-key="t1_col4" class="main-data-input w-full text-center" placeholder="مثال: مركز مصادر التعلم">
        </div>
      </div>

      <!-- جدول 1: الكادر -->
      <div class="mb-0 mt-1">
        <h2 class="h2-title">الكادر المفعل للتعليم الإلكتروني</h2>
        <table class="report-table">
          <thead>
            <tr>
              <th class="w-8">م</th>
              <th class="w-1/2">اسم الكادر المفعل للتعليم الالكتروني</th>
              <th class="w-1/2">عمله داخل المدرسة</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>1</td><td><input type="text" data-key="t2_r1c1" class="fillable-input" placeholder="الاسم"></td><td><input type="text" data-key="t2_r1c2" class="fillable-input" placeholder="العمل"></td></tr>
            <tr><td>2</td><td><input type="text" data-key="t2_r2c1" class="fillable-input" placeholder="الاسم"></td><td><input type="text" data-key="t2_r2c2" class="fillable-input" placeholder="العمل"></td></tr>
            <tr><td>3</td><td><input type="text" data-key="t2_r3c1" class="fillable-input" placeholder="الاسم"></td><td><input type="text" data-key="t2_r3c2" class="fillable-input" placeholder="العمل"></td></tr>
            <tr><td>4</td><td><input type="text" data-key="t2_r4c1" class="fillable-input" placeholder="الاسم"></td><td><input type="text" data-key="t2_r4c2" class="fillable-input" placeholder="العمل"></td></tr>
          </tbody>
        </table>
      </div>

      <!-- جدول 2: المنصة والأجهزة -->
      <div class="mb-0">
        <h2 class="h2-title">نوع التفعيل الإلكتروني المستخدم واسم الجهاز</h2>
        <table class="report-table">
          <thead>
            <tr>
              <th class="w-1/2">نوع التفعيل الإلكتروني المستخدم (المنصة/القناة/البرنامج)</th>
              <th class="w-1/2">اسم الجهاز الإلكتروني المستخدم (اختر الأجهزة)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="p-0 align-top">
                <table class="report-table border-0 w-full">
                  <tr class="border-0">
                    <td class="border w-1/3 font-bold text-xs text-right">اسم المنصة:</td>
                    <td class="border w-2/3 p-0"><input type="text" data-key="t3_r1c2" class="fillable-input platform-input text-right" placeholder="مثال: منصة مدرستي"></td>
                  </tr>
                  <tr class="border-0">
                    <td class="border w-1/3 font-bold text-xs text-right">اسم القناة/المصدر:</td>
                    <td class="border w-2/3 p-0"><input type="text" data-key="t3_r2c2" class="fillable-input platform-input text-right" placeholder="مثال: قناة عين"></td>
                  </tr>
                  <tr class="border-0">
                    <td class="border w-1/3 font-bold text-xs text-right">اسم البرنامج:</td>
                    <td class="border w-2/3 p-0"><input type="text" data-key="t3_r3c2" class="fillable-input platform-input text-right" placeholder="مثال: Teams / Zoom"></td>
                  </tr>
                  <tr class="border-0">
                    <td class="border w-1/3 font-bold text-xs text-right">أخرى:</td>
                    <td class="border w-2/3 p-0"><input type="text" data-key="t3_r4c2" class="fillable-input platform-input text-right" placeholder="حدد نوع التفعيل الآخر"></td>
                  </tr>
                </table>
              </td>
              <td class="p-0">
                <table class="report-table border-0 w-full">
                  <tbody>
                    <tr class="border-0">
                      <td class="border-0 w-1/2 text-right">جهاز عرض (بروجكتر)</td>
                      <td class="border-0 w-1/4"><input type="checkbox" data-key="t4_c1" class="h-4 w-4 bg-white border-gray-300 rounded text-blue-600 focus:ring-blue-500"></td>
                      <td class="border-0 w-1/4 text-right">جهاز كمبيوتر مكتبي</td>
                      <td class="border-0 w-1/4"><input type="checkbox" data-key="t4_c2" class="h-4 w-4 bg-white border-gray-300 rounded text-blue-600 focus:ring-blue-500"></td>
                    </tr>
                    <tr class="border-0">
                      <td class="border-0 w-1/2 text-right">جهاز لابتوب</td>
                      <td class="border-0 w-1/4"><input type="checkbox" data-key="t4_c3" class="h-4 w-4 bg-white border-gray-300 rounded text-blue-600 focus:ring-blue-500"></td>
                      <td class="border-0 w-1/4 text-right">جهاز الايباد</td>
                      <td class="border-0 w-1/4"><input type="checkbox" data-key="t4_c4" class="h-4 w-4 bg-white border-gray-300 rounded text-blue-600 focus:ring-blue-500"></td>
                    </tr>
                    <tr class="border-0">
                      <td class="border-0 w-1/2 text-right">جهاز الجوال</td>
                      <td class="border-0 w-1/4"><input type="checkbox" data-key="t4_c5" class="h-4 w-4 bg-white border-gray-300 rounded text-blue-600 focus:ring-blue-500"></td>
                      <td class="border-0 w-1/4 text-right">أخرى: <input type="text" data-key="t4_c6_text" class="fillable-input w-20 text-xs text-right" placeholder="جهاز آخر"></td>
                      <td class="border-0 w-1/4"><input type="checkbox" data-key="t4_c6" class="h-4 w-4 bg-white border-gray-300 rounded text-blue-600 focus:ring-blue-500"></td>
                    </tr>
                  </tbody>
                </table>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- جدول 3: الفئة المستهدفة -->
      <div class="mb-0">
        <h2 class="h2-title">الفئة المستهدفة</h2>
        <table class="report-table">
          <thead>
            <tr>
              <th class="w-1/6">رقم</th>
              <th class="w-1/3">تحديد الفئة</th>
              <th class="w-1/6">رقم</th>
              <th class="w-1/3">تحديد الفئة</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td><input type="text" data-key="t5_r1c1" class="fillable-input" placeholder="الفئة المستهدفة (مثال: طلاب الصف الثالث ثانوي)"></td>
              <td>2</td>
              <td><input type="text" data-key="t5_r1c2" class="fillable-input" placeholder="الفئة المستهدفة"></td>
            </tr>
            <tr>
              <td>3</td>
              <td><input type="text" data-key="t5_r1c3" class="fillable-input" placeholder="الفئة المستهدفة"></td>
              <td>4</td>
              <td><input type="text" data-key="t5_r1c4" class="fillable-input" placeholder="الفئة المستهدفة"></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- جدول 4: الأهداف والأثر -->
      <div class="mb-0">
        <h2 class="h2-title">الأهداف والأثر التربوي</h2>
        <table class="report-table">
          <thead>
            <tr>
              <th class="w-1/2">الهدف من استخدام التفعيل الإلكتروني (1 - 4 أهداف)</th>
              <th class="w-1/2">الأثر الإيجابي التربوي والتعليمي للتفعيل الإلكتروني المذكور</th>
            </tr>
          </thead>
          <tbody>
            <tr><td><input type="text" data-key="t6_r1c1" class="fillable-input" placeholder="الهدف 1"></td><td><input type="text" data-key="t6_r1c2" class="fillable-input" placeholder="الأثر 1"></td></tr>
            <tr><td><input type="text" data-key="t6_r2c1" class="fillable-input" placeholder="الهدف 2"></td><td><input type="text" data-key="t6_r2c2" class="fillable-input" placeholder="الأثر 2"></td></tr>
            <tr><td><input type="text" data-key="t6_r3c1" class="fillable-input" placeholder="الهدف 3"></td><td><input type="text" data-key="t6_r3c2" class="fillable-input" placeholder="الأثر 3"></td></tr>
            <tr><td><input type="text" data-key="t6_r4c1" class="fillable-input" placeholder="الهدف 4"></td><td><input type="text" data-key="t6_r4c2" class="fillable-input" placeholder="الأثر 4"></td></tr>
          </tbody>
        </table>
      </div>

      <!-- الشواهد (صور) -->
      <div class="mb-0">
        <h2 class="h2-title">شواهد التفعيل (صور)</h2>
        <div class="evidence-box flex justify-between gap-2 p-1 items-center border border-dashed border-gray-400 rounded-lg">
          <div class="image-slot-container">
            <div id="imageSlot1" class="image-slot-aspect relative">
              <div class="image-slot-content">
                <input type="file" id="fileInput1" data-slot="1" accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer z-20" onchange="handleImageUpload(this)">
                <img id="preview1" class="absolute inset-0 w-full h-full object-cover hidden z-10">
                <span id="label1" class="p-1 text-black z-0 font-bold">صورة 1 (اضغط للتحميل)</span>
              </div>
            </div>
          </div>
          <div class="image-slot-container">
            <div id="imageSlot2" class="image-slot-aspect relative">
              <div class="image-slot-content">
                <input type="file" id="fileInput2" data-slot="2" accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer z-20" onchange="handleImageUpload(this)">
                <img id="preview2" class="absolute inset-0 w-full h-full object-cover hidden z-10">
                <span id="label2" class="p-1 text-black z-0 font-bold">صورة 2 (اضغط للتحميل)</span>
              </div>
            </div>
          </div>
          <div class="image-slot-container">
            <div id="imageSlot3" class="image-slot-aspect relative">
              <div class="image-slot-content">
                <input type="file" id="fileInput3" data-slot="3" accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer z-20" onchange="handleImageUpload(this)">
                <img id="preview3" class="absolute inset-0 w-full h-full object-cover hidden z-10">
                <span id="label3" class="p-1 text-black z-0 font-bold">صورة 3 (اضغط للتحميل)</span>
              </div>
            </div>
          </div>
          <div class="image-slot-container">
            <div id="imageSlot4" class="image-slot-aspect relative">
              <div class="image-slot-content">
                <input type="file" id="fileInput4" data-slot="4" accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer z-20" onchange="handleImageUpload(this)">
                <img id="preview4" class="absolute inset-0 w-full h-full object-cover hidden z-10">
                <span id="label4" class="p-1 text-black z-0 font-bold">صورة 4 (اضغط للتحميل)</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div><!-- /content-wrapper -->

    <!-- التواقيع -->
    <div class="signature-footer px-4">
      <div class="text-center w-48 flex flex-col items-center">
        <p class="signature-label-text font-bold text-[10px]">أمينة مصادر التعلم</p>
        <input type="text" data-key="signature_1_name" class="signature-input-name" placeholder="الاسم" style="font-weight:900; border:none; background:transparent; text-align:center;">
      </div>
      <div class="text-center w-48 flex flex-col items-center">
        <p class="signature-label-text font-bold text-[10px]">مشرفة الدعم</p>
        <input type="text" data-key="signature_2_name" class="signature-input-name" placeholder="الاسم" style="font-weight:900; border:none; background:transparent; text-align:center;">
      </div>
      <div class="text-center w-48 flex flex-col items-center">
        <p class="signature-label-text font-bold text-[10px]">مديرة المدرسة</p>
        <input type="text" data-key="signature_3_name" class="signature-input-name" placeholder="الاسم" style="font-weight:900; border:none; background:transparent; text-align:center;">
      </div>
    </div>
  </div><!-- /a4-page -->

  <!-- منطق الحفظ بالمتصفح -->
  <script>
    const DATA_KEY = 'eLearningReportData';
    const IMAGE_SLOTS = 4;

    const allPersistentInputs = Array.from(document.querySelectorAll('input[data-key]:not([type="file"]), textarea[data-key]'));

    function fileToBase64(file){
      return new Promise((resolve,reject)=>{
        const reader = new FileReader();
        reader.onload = ()=>resolve(reader.result);
        reader.onerror = e=>reject(e);
        if(file.size > 800*1024){ reject(new Error("File size exceeds 800 KB limit. استخدم صورة أصغر.")); return; }
        reader.readAsDataURL(file);
      });
    }

    window.handleImageUpload = async function(input){
      const slotNumber = input.getAttribute('data-slot');
      const file = input.files[0];
      const preview = document.getElementById(`preview${slotNumber}`);
      const label = document.getElementById(`label${slotNumber}`);
      const imageKey = `imageSlot${slotNumber}`;
      if(file){
        try{
          const base64 = await fileToBase64(file);
          preview.src = base64;
          preview.classList.remove('hidden'); preview.classList.add('z-10');
          label.classList.add('hidden');
          saveData({ [imageKey]: base64 });
        }catch(err){
          preview.src=''; preview.classList.add('hidden'); preview.classList.remove('z-10');
          label.classList.remove('hidden'); input.value='';
          saveData({ [imageKey]: '' });
          alert("خطأ في تحميل الصورة: " + err.message);
        }
      }else{
        preview.classList.add('hidden'); preview.classList.remove('z-10');
        label.classList.remove('hidden'); saveData({ [imageKey]: '' });
      }
    }

    function saveData(partial={}){
      const data = {};
      try{
        const stored = localStorage.getItem(DATA_KEY);
        if(stored) Object.assign(data, JSON.parse(stored));
      }catch(e){}

      allPersistentInputs.forEach(input=>{
        const key = input.getAttribute('data-key');
        if(input.type === 'checkbox'){ data[key] = input.checked; }
        else{ data[key] = input.value; }
      });

      Object.assign(data, partial);

      try{ localStorage.setItem(DATA_KEY, JSON.stringify(data)); }
      catch(e){ alert("تجاوزت سعة التخزين في المتصفح. احذف بعض الصور أو قلّل حجمها."); }
    }

    function loadData(){
      try{
        const stored = localStorage.getItem(DATA_KEY);
        if(!stored) return;
        const data = JSON.parse(stored);

        allPersistentInputs.forEach(input=>{
          const key = input.getAttribute('data-key');
          if(data[key] !== undefined){
            if(input.type === 'checkbox'){ input.checked = data[key]; }
            else{ input.value = data[key]; }
          }
        });

        for(let i=1;i<=IMAGE_SLOTS;i++){
          const base64 = data[`imageSlot${i}`] || '';
          const preview = document.getElementById(`preview${i}`);
          const label = document.getElementById(`label${i}`);
          if(base64 && base64.startsWith('data:')){
            preview.src = base64;
            preview.classList.remove('hidden'); preview.classList.add('z-10');
            label.classList.add('hidden');
          }else{
            preview.src=''; preview.classList.add('hidden'); preview.classList.remove('z-10');
            label.classList.remove('hidden');
          }
        }
      }catch(e){}
    }

    let saveTimeout;
    const DEBOUNCE=500;
    function debounceSave(){ clearTimeout(saveTimeout); saveTimeout=setTimeout(()=>saveData(), DEBOUNCE); }
    allPersistentInputs.forEach(i=> i.addEventListener('input', debounceSave));

    window.onload = loadData;
  </script>
</body>
</html>
